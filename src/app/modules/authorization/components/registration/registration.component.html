<div class="wrapper">
  <h1>Агрегатор</h1>
  <mat-stepper orientation="horizontal" linear = false>
    <mat-step [stepControl]="form.controls.firstStep">
      <form [formGroup]="form.controls.firstStep" class="wrapper__form">
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: firstStep.controls.email, type: 'text', label: 'Почта'}"></ng-container>
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: firstStep.controls.password, type: 'password', label: 'Пароль'}"></ng-container>
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: firstStep.controls.repeatPassword, type: 'password', label: 'Повторите пароль'}"></ng-container>
      </form>
      <button mat-button matStepperNext>Next</button>
    </mat-step>

    <mat-step [stepControl]="form.controls.secondStep">
      <form  class="wrapper__form" [formGroup]="form.controls.secondStep">
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: secondStep.controls.name, type: 'text', label: 'Имя'}"></ng-container>
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: secondStep.controls.surname, type: 'text', label: 'Фамилия'}"></ng-container>
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: secondStep.controls.patronic, type: 'text', label: 'Отчество'}"></ng-container>
      </form>
      <section>
        <button mat-button matStepperPrevious>Previous</button>
        <button mat-button matStepperNext>Next</button>
      </section>
    </mat-step>

    <mat-step [stepControl]="form.controls.thirdStep">
      <form  class="wrapper__form" [formGroup]="form.controls.thirdStep">
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: thirdStep.controls.companyName, type: 'text', label: 'Название компании'}"></ng-container>
        <ng-container *ngTemplateOutlet="inputControlTemplate; context: {$implicit: thirdStep.controls.INN, type: 'text', label: 'ИНН'}"></ng-container>
        <mat-form-field *ngLet="specializations$ | async as specializations" [appearance]="'outline'">
          <mat-label>Специализация</mat-label>
          <mat-chip-grid #chipGrid>
            <mat-chip-row *ngFor="let specialization of thirdStep.controls.specialization.value" (removed)="removeSpecialization(specialization.ID)">
              {{specialization.name}}
              <button matChipRemove [attr.aria-label]="'remove ' + specialization.name">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          </mat-chip-grid>
          <input #specInput placeholder="New Fruit..." [formControl]="specializationInput"
                 [matChipInputFor]="chipGrid" [matAutocomplete]="auto"
                 [matChipInputSeparatorKeyCodes]="[]">
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addSpecialization($event.option.value, specializations); specInput.value = ''">
            <mat-option
              *ngFor="let specialization of (specializations | specializationFilter : thirdStep.controls.specialization.value : specializationNameFilter$) | async"
              [value]="specialization.ID">
              {{specialization.name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </form>
      <button mat-button matStepperPrevious>Previous</button>
    </mat-step>
  </mat-stepper>
</div>


<!--Темплейты-->

<ng-template #inputControlTemplate let-control let-type = "type" let-label = "label">
  <mat-form-field appearance="outline">
    <mat-label>{{label}}</mat-label>
    <input [formControl]="control" matInput [type]="type">
  </mat-form-field>
</ng-template>

<ng-template #selectControlTemplate let-control let-options = "options" let-label = "label">
  <mat-form-field appearance="outline">
    <mat-label>{{label}}</mat-label>
    <mat-select [formControl]="control">
      <mat-option *ngFor="let opt of options"></mat-option>
    </mat-select>
  </mat-form-field>
</ng-template>
